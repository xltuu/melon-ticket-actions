# name: example

# on:
#   schedule:
#     - cron: '*/5 * * * *' # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰

# jobs:
#   check-tickets: # jobì˜ ì´ë¦„ì„ ë” ëª…í™•í•˜ê²Œ ë³€ê²½
#     runs-on: ubuntu-latest
#     timeout-minutes: 5

#     strategy: # ğŸ‘ˆ 1. strategy(ì „ëµ) ë¸”ë¡ ì¶”ê°€
#       fail-fast: false # ğŸ‘ˆ (ì„ íƒ ì‚¬í•­) í•˜ë‚˜ì˜ ì‘ì—…ì´ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ì‹¤í–‰í•˜ê²Œ í•¨
#       matrix:
#         # 100067ë¶€í„° 100088ê¹Œì§€ì˜ ìˆ«ì ëª©ë¡ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
#         schedule-id: ${{ fromJSON(format('[{0}]', join(range(100001, 100441), ','))) }}

#     steps:
#       - name: Check Tickets
#         uses: xltuu/melon-ticket-actions@master
#         with:
#           product-id: 211942
#           schedule-id: ${{ matrix.schedule-id }} # ğŸ‘ˆ 3. matrixì— ìˆëŠ” idë¥¼ í•˜ë‚˜ì”© ê°€ì ¸ì™€ ì‚¬ìš©
#           seat-id: 1_0
#           slack-incoming-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
#           message: '<@U4CF18RKL> í‹°ì¼“ì‚¬ì„¸ìš”! (íšŒì°¨: ${{ matrix.schedule-id }})' # ë©”ì‹œì§€ì— ì–´ë–¤ íšŒì°¨ì¸ì§€ ì¶”ê°€í•˜ë©´ ë” ì¢‹ìŒ


name: example

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  # ----------------------------------------------------
  # 1. schedule-id ëª©ë¡ì„ ìƒì„±í•˜ëŠ” ì²« ë²ˆì§¸ ì‘ì—…
  # ----------------------------------------------------
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      # ğŸ‘‡ 1. ì‘ì—… ê²°ê³¼ë¬¼ì˜ ì´ë¦„ì„ 'matrix_json'ìœ¼ë¡œ ë³€ê²½
      matrix_json: ${{ steps.set_matrix.outputs.id_list }}
    
    steps:
    - id: set_matrix
      name: Generate schedule-id list
      run: |
        # ğŸ‘‡ 2. ìŠ¤í… ê²°ê³¼ë¬¼ì˜ ì´ë¦„ë„ í•˜ì´í”ˆ ì—†ëŠ” 'id_list'ë¡œ ë³€ê²½
        # ğŸ‘‡ 3. rangeì˜ ë§ˆì§€ë§‰ ìˆ«ìì— +1ì„ í•´ì•¼ í•´ë‹¹ ìˆ«ìê¹Œì§€ í¬í•¨ë©ë‹ˆë‹¤.
        echo "id_list=$(jq -c -n 'range(100001\; 100441)')" >> $GITHUB_OUTPUT

  # ----------------------------------------------------
  # 2. ìƒì„±ëœ ëª©ë¡ìœ¼ë¡œ í‹°ì¼“ì„ í™•ì¸í•˜ëŠ” ë‘ ë²ˆì§¸ ì‘ì—…
  # ----------------------------------------------------
  check-tickets:
    needs: generate-matrix
    runs-on: ubuntu-latest
    timeout-minutes: 5

    strategy:
      fail-fast: false
      matrix:
        # ğŸ‘‡ 4. ìœ„ì—ì„œ ë³€ê²½í•œ ê²°ê³¼ë¬¼ ì´ë¦„(matrix_json)ì„ ê°€ì ¸ì™€ ì‚¬ìš©
        schedule-id: ${{ fromJSON(needs.generate-matrix.outputs.matrix_json) }}

    steps:
      - name: Check Tickets
        uses: xltuu/melon-ticket-actions@master
        with:
          product-id: 211942
          schedule-id: ${{ matrix.schedule-id }}
          seat-id: "1_0"
          slack-incoming-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          message: '<@U4CF18RKL> í‹°ì¼“ì‚¬ì„¸ìš”! (íšŒì°¨: ${{ matrix.schedule-id }})'
