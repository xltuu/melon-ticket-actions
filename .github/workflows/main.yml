name: example

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  # ----------------------------------------------------
  # 1. schedule-id ëª©ë¡ì„ ë‘ ê°œì˜ ë©ì–´ë¦¬ë¡œ ìƒì„±í•˜ëŠ” ì‘ì—…
  # ----------------------------------------------------
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix_json_1: ${{ steps.set_matrix.outputs.id_list_1 }}
      matrix_json_2: ${{ steps.set_matrix.outputs.id_list_2 }}
    
    steps:
    - id: set_matrix
      name: Generate and filter schedule-id lists
      run: |
        # ğŸ‘‡ ìƒì„±, í•„í„°ë§, ë‚˜ëˆ„ê¸° ê³¼ì •ì„ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ í†µí•©í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
        echo "id_list_1=$(jq -c -n '[range(100001; 100441 + 1)] | map(select(. < 100133 or . > 100143)) | .[0:220]')" >> $GITHUB_OUTPUT
        echo "id_list_2=$(jq -c -n '[range(100001; 100441 + 1)] | map(select(. < 100133 or . > 100143)) | .[220:]')" >> $GITHUB_OUTPUT

  # ----------------------------------------------------
  # 2. ì²« ë²ˆì§¸ ëª©ë¡ìœ¼ë¡œ í‹°ì¼“ì„ í™•ì¸í•˜ëŠ” ì‘ì—…
  # ----------------------------------------------------
  check-tickets-1:
    needs: generate-matrix
    runs-on: ubuntu-latest
    timeout-minutes: 5
    strategy:
      fail-fast: false
      matrix:
        schedule-id: ${{ fromJSON(needs.generate-matrix.outputs.matrix_json_1) }}

    steps:
      - name: Check Tickets (Part 1)
        uses: xltuu/melon-ticket-actions@master
        with:
          product-id: 211942
          schedule-id: ${{ matrix.schedule-id }}
          seat-id: "1_0"
          slack-incoming-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          message: '<@U4CF18RKL> í‹°ì¼“ì‚¬ì„¸ìš”! (íšŒì°¨: ${{ matrix.schedule-id }})'

  # ----------------------------------------------------
  # 3. ë‘ ë²ˆì§¸ ëª©ë¡ìœ¼ë¡œ í‹°ì¼“ì„ í™•ì¸í•˜ëŠ” ì‘ì—…
  # ----------------------------------------------------
  check-tickets-2:
    needs: generate-matrix
    runs-on: ubuntu-latest
    timeout-minutes: 5
    strategy:
      fail-fast: false
      matrix:
        schedule-id: ${{ fromJSON(needs.generate-matrix.outputs.matrix_json_2) }}

    steps:
      - name: Check Tickets (Part 2)
        uses: xltuu/melon-ticket-actions@master
        with:
          product-id: 211942
          schedule-id: ${{ matrix.schedule-id }}
          seat-id: "1_0"
          slack-incoming-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          message: '<@U4CF18RKL> í‹°ì¼“ì‚¬ì„¸ìš”! (íšŒì°¨: ${{ matrix.schedule-id }})'
